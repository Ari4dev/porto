---
import projectsData from '../data/projects.json';

interface Project {
  id: string;
  name: string;
  title: string;
  role: string;
  technologies: string[];
  description: string;
  problem: string;
  image: string;
  githubUrl: string;
  liveUrl: string;
  features: string[];
  highlights: string[];
}

const projects: Project[] = projectsData;

const categories = [
  { id: 'all', label: 'All Projects' },
  { id: 'dashboard', label: 'Dashboards' },
  { id: 'app', label: 'Web Apps' },
  { id: 'landing', label: 'Landing Pages' },
  { id: 'tool', label: 'Tools' },
];
---

<section id="projects" class="projects section">
  <div class="container">
    <div class="section-header">
      <span class="badge badge-accent">My Work</span>
      <h2 class="section-title">Featured Projects</h2>
      <p class="section-subtitle">
        A selection of projects that showcase my skills and passion for frontend development
      </p>
    </div>
    
    <!-- Filter Tabs -->
    <div class="filter-tabs" role="tablist">
      {categories.map((cat, index) => (
        <button 
          class={`filter-tab ${index === 0 ? 'active' : ''}`} 
          data-category={cat.id}
          role="tab"
          aria-selected={index === 0 ? 'true' : 'false'}
        >
          {cat.label}
        </button>
      ))}
    </div>
    
    <!-- Projects Grid -->
    <div class="projects-grid" id="projectsGrid">
      {projects.map((project, index) => (
        <article 
          class="project-card" 
          data-category={project.id.includes('dashboard') || project.id.includes('crypto') ? 'dashboard' : project.id.includes('landing') || project.id.includes('restaurant') ? 'landing' : project.id.includes('generator') || project.id.includes('portfolio') || project.id.includes('pomodoro') ? 'tool' : 'app'}
          data-index={index}
          style={`--delay: ${index * 0.1}s`}
        >
          <!-- Image -->
          <div class="project-image">
            <img 
              src={project.image} 
              alt={project.title}
              loading="lazy"
              class="project-img"
            />
            <div class="project-overlay">
              <span class="view-btn">View Details</span>
            </div>
          </div>
          
          <!-- Content -->
          <div class="project-content">
            <div class="project-meta">
              <span class="project-name">{project.name}</span>
              <span class="project-role">{project.role}</span>
            </div>
            
            <h3 class="project-title">{project.title}</h3>
            
            <p class="project-description">{project.description}</p>
            
            <!-- Tech Stack -->
            <div class="project-tech">
              {project.technologies.slice(0, 4).map((tech) => (
                <span class="tech-pill">{tech}</span>
              ))}
            </div>
          </div>
        </article>
      ))}
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="projectModal">
    <div class="modal-box">
      <button class="modal-close-btn" id="modalCloseBtn">&times;</button>
      <div class="modal-body">
        <div class="modal-img-wrap">
          <img id="modalImg" src="" alt="" />
        </div>
        <div class="modal-info">
          <div class="modal-top">
            <span class="modal-badge" id="modalBadge"></span>
            <span class="modal-role-text" id="modalRoleText"></span>
          </div>
          <h2 class="modal-heading" id="modalHeading"></h2>
          <p class="modal-desc" id="modalDesc"></p>
          
          <div class="modal-section-block">
            <h4>The Challenge</h4>
            <p id="modalChallenge"></p>
          </div>
          
          <div class="modal-section-block">
            <h4>Technologies</h4>
            <div class="modal-tech-list" id="modalTechList"></div>
          </div>
          
          <div class="modal-section-block">
            <h4>Key Features</h4>
            <ul class="modal-feature-list" id="modalFeatureList"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Inline data for JavaScript -->
<script is:inline define:vars={{ projects: JSON.stringify(projectsData) }}>
  const projectsArray = JSON.parse(projects);
  
  // Elements
  const modal = document.getElementById('projectModal');
  const closeBtn = document.getElementById('modalCloseBtn');
  const cards = document.querySelectorAll('.project-card');
  const tabs = document.querySelectorAll('.filter-tab');
  
  // Modal elements
  const modalImg = document.getElementById('modalImg');
  const modalBadge = document.getElementById('modalBadge');
  const modalRoleText = document.getElementById('modalRoleText');
  const modalHeading = document.getElementById('modalHeading');
  const modalDesc = document.getElementById('modalDesc');
  const modalChallenge = document.getElementById('modalChallenge');
  const modalTechList = document.getElementById('modalTechList');
  const modalFeatureList = document.getElementById('modalFeatureList');

  // Open modal
  function showModal(idx) {
    const p = projectsArray[idx];
    if (!p) return;
    
    modalImg.src = p.image;
    modalImg.alt = p.title;
    modalBadge.textContent = p.name;
    modalRoleText.textContent = p.role;
    modalHeading.textContent = p.title;
    modalDesc.textContent = p.description;
    modalChallenge.textContent = p.problem;
    
    modalTechList.innerHTML = p.technologies.map(t => 
      '<span class="modal-tech-pill">' + t + '</span>'
    ).join('');
    
    modalFeatureList.innerHTML = p.features.map(f => 
      '<li>' + f + '</li>'
    ).join('');
    
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  // Close modal
  function hideModal() {
    modal.classList.remove('active');
    document.body.style.overflow = '';
  }

  // Card click
  cards.forEach(card => {
    card.addEventListener('click', function() {
      const idx = parseInt(this.getAttribute('data-index'));
      showModal(idx);
    });
  });

  // Close events
  closeBtn.addEventListener('click', hideModal);
  modal.addEventListener('click', function(e) {
    if (e.target === modal) hideModal();
  });
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') hideModal();
  });

  // Filter
  tabs.forEach(tab => {
    tab.addEventListener('click', function() {
      tabs.forEach(t => {
        t.classList.remove('active');
        t.setAttribute('aria-selected', 'false');
      });
      this.classList.add('active');
      this.setAttribute('aria-selected', 'true');

      const cat = this.getAttribute('data-category');
      cards.forEach((card, i) => {
        const cardCat = card.getAttribute('data-category');
        if (cat === 'all' || cardCat === cat) {
          card.classList.remove('hidden');
          card.style.animation = 'none';
          card.offsetHeight;
          card.style.animation = 'fadeInUp 0.5s ease forwards ' + (i * 0.1) + 's';
        } else {
          card.classList.add('hidden');
        }
      });
    });
  });
</script>

<style>
  .projects {
    background: var(--color-bg-secondary);
  }

  /* Filter Tabs */
  .filter-tabs {
    display: flex;
    justify-content: center;
    gap: var(--space-2);
    margin-bottom: var(--space-10);
    flex-wrap: wrap;
  }

  .filter-tab {
    padding: var(--space-2) var(--space-5);
    background: transparent;
    border: none;
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
    border-radius: var(--radius-lg);
  }

  .filter-tab:hover {
    color: var(--color-text-primary);
  }

  .filter-tab.active {
    color: var(--color-text-primary);
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
  }

  /* Grid */
  .projects-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-6);
  }

  .project-card {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    overflow: hidden;
    cursor: pointer;
    transition: all var(--transition-base);
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.5s ease forwards;
    animation-delay: var(--delay);
  }

  .project-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-xl);
    border-color: var(--color-accent);
  }

  .project-card.hidden {
    display: none;
  }

  /* Image */
  .project-image {
    position: relative;
    height: 200px;
    overflow: hidden;
  }

  .project-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--transition-base);
  }

  .project-card:hover .project-img {
    transform: scale(1.05);
  }

  .project-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity var(--transition-base);
  }

  .project-card:hover .project-overlay {
    opacity: 1;
  }

  .view-btn {
    padding: var(--space-3) var(--space-5);
    background: var(--color-accent);
    color: white;
    border-radius: var(--radius-lg);
    font-size: var(--text-sm);
    font-weight: 600;
  }

  /* Content */
  .project-content {
    padding: var(--space-5);
  }

  .project-meta {
    display: flex;
    justify-content: space-between;
    margin-bottom: var(--space-2);
  }

  .project-name {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--color-accent);
  }

  .project-role {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
  }

  .project-title {
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--color-text-primary);
    margin-bottom: var(--space-3);
  }

  .project-description {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    line-height: 1.6;
    margin-bottom: var(--space-4);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .project-tech {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .tech-pill {
    padding: var(--space-1) var(--space-3);
    background: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.2);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    color: var(--color-accent);
  }

  /* Modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: rgba(0,0,0,0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
    padding: 20px;
  }

  .modal-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .modal-box {
    position: relative;
    width: 100%;
    max-width: 900px;
    max-height: 85vh;
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-2xl);
    overflow: hidden;
  }

  .modal-close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 36px;
    height: 36px;
    background: rgba(255,255,255,0.1);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 24px;
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
  }

  .modal-close-btn:hover {
    background: var(--color-accent);
  }

  .modal-body {
    display: grid;
    grid-template-columns: 1fr 1fr;
    max-height: 85vh;
    overflow: hidden;
  }

  .modal-img-wrap {
    background: var(--color-bg-secondary);
  }

  .modal-img-wrap img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    min-height: 400px;
  }

  .modal-info {
    padding: 30px;
    overflow-y: auto;
    max-height: 85vh;
  }

  .modal-top {
    display: flex;
    gap: 15px;
    margin-bottom: 10px;
  }

  .modal-badge {
    font-size: 12px;
    font-weight: 600;
    color: var(--color-accent);
  }

  .modal-role-text {
    font-size: 12px;
    color: var(--color-text-muted);
  }

  .modal-heading {
    font-size: 24px;
    font-weight: 700;
    color: var(--color-text-primary);
    margin-bottom: 15px;
  }

  .modal-desc {
    font-size: 14px;
    color: var(--color-text-secondary);
    line-height: 1.7;
    margin-bottom: 25px;
  }

  .modal-section-block {
    margin-bottom: 20px;
  }

  .modal-section-block h4 {
    font-size: 11px;
    font-weight: 600;
    color: var(--color-accent);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 10px;
  }

  .modal-section-block p {
    font-size: 13px;
    color: var(--color-text-secondary);
    line-height: 1.6;
  }

  .modal-tech-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .modal-tech-pill {
    padding: 6px 14px;
    background: rgba(99, 102, 241, 0.15);
    border: 1px solid rgba(99, 102, 241, 0.3);
    border-radius: 20px;
    font-size: 12px;
    color: var(--color-accent);
  }

  .modal-feature-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .modal-feature-list li {
    padding: 6px 0;
    padding-left: 20px;
    position: relative;
    font-size: 13px;
    color: var(--color-text-secondary);
  }

  .modal-feature-list li::before {
    content: 'âœ“';
    position: absolute;
    left: 0;
    color: #10b981;
    font-weight: 600;
  }

  /* Responsive */
  @media (max-width: 1023px) {
    .projects-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    .modal-body {
      grid-template-columns: 1fr;
    }
    .modal-img-wrap img {
      min-height: 200px;
      max-height: 250px;
    }
  }

  @media (max-width: 767px) {
    .projects-grid {
      grid-template-columns: 1fr;
    }
    .filter-tab {
      padding: var(--space-2) var(--space-3);
      font-size: var(--text-xs);
    }
    .modal-info {
      padding: 20px;
    }
    .modal-heading {
      font-size: 20px;
    }
  }
</style>
